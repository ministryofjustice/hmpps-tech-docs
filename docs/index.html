<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
      <meta name="robots" content="noindex">

    <title>HMPPS Tech Team docs</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://tech-docs.hmpps.service.justice.gov.uk/">


      <meta property="og:image" content="https://tech-docs.hmpps.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="HMPPS Tech Team docs" />
      <meta property="og:title" content="HMPPS Tech Team docs" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://tech-docs.hmpps.service.justice.gov.uk/" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="tech-docs.hmpps.service.justice.gov.uk" />
      <meta property="twitter:image" content="https://tech-docs.hmpps.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="HMPPS Tech Team docs" />
      <meta property="twitter:url" content="https://tech-docs.hmpps.service.justice.gov.uk/" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          HMPPS Tech Team docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="mailto:dps+hmpps@digital.justice.gov.uk?subject=Tech+Team+docs+feedback">Feedback / Report a problem</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/">Documentation</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/hmpps-tech-docs">GitHub</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://tech-docs.hmpps.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#hmpps-tech-team-docs"><span>HMPPS Tech Team docs</span></a>
    <ul>
      <li>
        <a href="#who-is-this-documentation-for"><span>Who is this documentation for?</span></a>
        <ul>
          <li>
            <a href="#readme"><span>README</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#publishing-apis"><span>Publishing APIs</span></a>
      </li>
      <li>
        <a href="#coding-standards"><span>Coding standards</span></a>
        <ul>
          <li>
            <a href="#breaking-changes"><span>Breaking changes</span></a>
          </li>
          <li>
            <a href="#releases"><span>Releases</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#service-endpoints"><span>Service endpoints</span></a>
        <ul>
          <li>
            <a href="#health"><span>/health</span></a>
          </li>
          <li>
            <a href="#ping"><span>/ping</span></a>
          </li>
          <li>
            <a href="#info"><span>/info</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#deployments"><span>Deployments</span></a>
        <ul>
          <li>
            <a href="#helm"><span>Helm</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#monitoring"><span>Monitoring</span></a>
        <ul>
          <li>
            <a href="#logging-requests-with-individual-clients"><span>Logging requests with individual clients</span></a>
          </li>
          <li>
            <a href="#correlating-requests"><span>Correlating requests</span></a>
          </li>
          <li>
            <a href="#application-version"><span>Application version</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#adding-to-the-documentation"><span>Adding to the documentation</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <h1 id="hmpps-tech-team-docs">HMPPS Tech Team docs</h1><h2 id="who-is-this-documentation-for">Who is this documentation for?</h2><p>This documentation describes what standards we adhere to when writing our services, as well as providing guidelines for interaction.</p>
<h3 id="readme">README</h3><p>All our services should have a github README.md at the root of their repository. Information in this should include:</p>

<ul>
<li>Who to contact with any questions</li>
<li>Where the API docs are located</li>
<li>How to call the endpoints and whether any authentication / special authorisation is required</li>
<li>How to check that the service is up and running i.e. the health endpoint</li>
<li>How to check that the service is responding to requests i.e. the ping endpoint</li>
<li>How to find out the version of the deployed application and link it back to a specific git commit.</li>
<li>How to rollback a deployed service to a previous version</li>
<li>How to run the application locally</li>
</ul>
<h2 id="publishing-apis">Publishing APIs</h2><p>All services should have clear API documentation that details the endpoints with the authorisation requirements.</p>
<p>The API documentation should be in OpenAPI 3 format, according to <a href="https://www.gov.uk/government/publications/recommended-open-standards-for-government/describing-restful-apis-with-openapi-3" title="Describing RESTful APIs with OpenAPI 3">GDS guidelines</a>.
It should include examples for the various data elements as well as the possible values for constrained items.</p>
<h2 id="coding-standards">Coding standards</h2><p>All our code is peer reviewed before being merged and then released.
All commits should include a JIRA reference so that we can trace back the reasons for the change etc.</p>
<h3 id="breaking-changes">Breaking changes</h3><p>We follow these principles for each of our endpoints:</p>

<ul>
<li>We do not take anything away</li>
<li>We do not change processing rules</li>
<li>We do not make optional things required</li>
<li>Anything we add must be optional</li>
</ul>
<p>Consumers need to be resilient enough to support these changes, e.g. they shouldn&rsquo;t bind tightly to an expected representation as new fields may be added at a later date.</p>
<p>This means that a new endpoint should be added instead of making a breaking change to an existing endpoint.
Since we know what clients call which endpoints we can then inform the clients to switch to the new endpoint.
When all the clients have switched over we can then remove the old endpoint.</p>
<h3 id="releases">Releases</h3><p>We will endevour to release as soon as a new feature has been tested, rather than bulking up multiple changes into a release.
If an application release contains multiple changes since the last release then it is important that agreement with all the changers is sought before release.
A changelog will be generated containing all the changes since the last release to production and it will be posted in the appropriate slack channel.</p>
<h2 id="service-endpoints">Service endpoints</h2><h3 id="health"><code>/health</code></h3><p>Our services all provide a <code>/health</code> endpoint which checks all dependencies are healthy (e.g. database connection) and returns a http status of 200 if everything is up and running.
The endpoint shouldn&rsquo;t then call <code>/health</code> on any of the dependencies though as this will create cascading health checks so that one health check could call health checks in the dependencies, which could then call health checks in the dependencies etc.
This is called on a regular basis by our Pingdom check, which will then alert to us in slack in #dps_alerts if there are issues.
It is also called by the DPS Monitor at https://dps-monitor.prison.service.justice.gov.uk/health to provide a dashboard of all the DPS services health.</p>
<h3 id="ping"><code>/ping</code></h3><p>This is a simple check that will just return a http status of 200 if the application is up and running.
It is therefore entirely suited to be called by other applications&rsquo; health checks and also by kubernetes liveness and readiness probes if the application framework doesn&rsquo;t provide specific endpoints.</p>
<h3 id="info"><code>/info</code></h3><p>This provides basic information in a json format about the current application version, github commit reference and other useful application information.</p>
<h2 id="deployments">Deployments</h2><p>Our release candidates are automatically deployed to our development environments using circleci.
When a ticket has been successfully tested it is then approved for deployment to a production like environment before then being deployed to production.</p>
<h3 id="helm">Helm</h3><p>We use helm to manage the kubernetes deployments and configuration.
A helm_deploy/README is included in all projects to provide information on how to find out the current deployed version and also to rollback to previous vresions.</p>
<h2 id="monitoring">Monitoring</h2><p>We use <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/" title="Azure Monitor documentation">azure monitor</a> and in particular application insights to monitor our production systems.
Our applications logs are ingested, as well as requests, exceptions and dependency calls.
This means that we can tell how long requests take in our systems and how long each of the individual dependencies (e.g. database interactions) take.</p>
<h3 id="logging-requests-with-individual-clients">Logging requests with individual clients</h3><p>All HMPPS Auth tokens contain a <code>client_id</code> and optionally a <code>user_name</code>.
Each frontend application / service is issued with a different <code>client_id</code> so therefore this will uniquely identify a client.
For system to system interaction the <code>user_name</code> will normally be empty.
Both should then be included as extra attributes in the request logging so that clients can be identified and therefore we can track what clients are calling what endpoints and how often.</p>
<h3 id="correlating-requests">Correlating requests</h3><p>We confirm to <a href="https://www.w3.org/TR/trace-context/" title="Trace Context">W3C tracing guidelines</a>.
This means that we accept a <code>traceparent</code> header which can then be used to correlate requests across all applications and to identify a user&rsquo;s journey through the application stack.</p>
<h3 id="application-version">Application version</h3><p>All our requests are also augmented with the current version of the application to help identify when issues first occurred and link back to the correct code.
This is of format <date>.<circleci job number>.<github reference> so can be traced back not only to the circleci job that built the code, but also the github commit of the code.</p>
<h2 id="adding-to-the-documentation">Adding to the documentation</h2><p>If there&rsquo;s something missing, please either let us know and we&rsquo;ll add a new
article, or if you&rsquo;re comfortable writing one yourself, PRs will be gratefully
received. Details on how to get in touch are in the &ldquo;Getting Help&rdquo; section above, and
the &ldquo;GitHub&rdquo; link at the top right of this page will take you to the repository for this
guide.</p>


              <div data-module='page-expiry' data-last-reviewed-on="2021-06-18">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 18 March 2021.

        It needs to be reviewed again on 18 June 2021
.
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 18 June 2021.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/hmpps-tech-docs/blob/main/source/index.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/hmpps-tech-docs/issues/new?labels=bug&amp;title=Re:%20'HMPPS%20Tech%20Team%20docs'&amp;body=Problem%20with%20'HMPPS%20Tech%20Team%20docs'%20(https://tech-docs.hmpps.service.justice.gov.uk/)">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/hmpps-tech-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138188246-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138188246-1');
</script>

<script>
  // Add the current window.location to the body of the
  // feedback email message.
  function sendFeedback(mailto, event) {
    event.preventDefault();

    var body = "Feedback/Problem on page: " + window.location + "\n";
    var href = mailto + '&body=' + encodeURIComponent(body);

    window.location = href;
  }

  $(document).ready(function() {
    var feedbackLink = $('a[href^="mailto:"]:contains("Feedback")')[0];
    var mailto = feedbackLink.href;
    $(feedbackLink).on('click', function(event) { sendFeedback(mailto, event); });
  });
</script>
