---
title: HMPPS Application Platform
last_reviewed_on: 2021-09-06
review_in: 3 months
weight: 20
---

# <%= current_page.data.title %>

This document describes the application platform used across HMPPS to share common development patterns.

## About the HMPPS Application Platform

The HMPPS Application Platform provides the core components developers need to start building applications quickly.

This includes:

* Template projects for frontend and backend services
* A project generator to automatically configure projects and build pipelines
* Build tools and plugins to use our standard build patterns
* Generic alerts to monitor application status
* Libraries for sharing common development patterns

All of the above are designed to work with the [MOJ Cloud Platform](https://user-guide.cloud-platform.service.justice.gov.uk/#cloud-platform-user-guide).

### Benefits of using the Application Platform

The Application Platform captures various patterns that have matured within the DPS development community and makes them easy to adopt on new projects.

#### Build new services quickly

Historically development teams would spend several weeks working on Sprint Zero to create a build pipeline for their skeleton project. Often Sprint Zero is never completed and projects start with the burden of technical debt.

By using our Project Bootstrapper it is possible to deploy a skeleton project to production in hours. This allows developers to quickly start delivering user stories and add value to the end users.

#### Adopt common standards

Innovation is encouraged but we don't want teams diverging too much. Otherwise we end up with many solutions to the same problems causing a maintenance headache for both developers and operations.

By using standard components available in the Application Platform we can manage services in a consistent way and share best practice.

#### Increase institutional knowledge

As the trickle of new services turns into a flood we find that many projects are at different levels of maturity. These then require different levels of support from teams of different sizes.

By using standard components we share knowledge of our development practices. This makes it easier to move developers between teams and provide the right levels of support where needed.

#### Secure services

Security is no longer an afterthought tagged onto the end of a project by overworked security and operations staff. To maintain a secure estate we must build security best practices in from the start of a project and in a consistent manner.

By using our various build tools it's easier to keep services up to date with the latest security patches and identify security vulnerabilities.

#### Add observability into services

No service runs in isolation and gaining a holistic view of the whole estate presents difficult challenges. There are many open source technologies to help with observability but these need coordinating between services to be successful.

By using our application templates we standardise the capturing of telemetry and tracing. This allow us to provide a common toolset for observing our suite of microservices.

#### Take advantage of mature development patterns

Many problems facing developers in HMPPS have been "solved" and using these patterns gives teams a head start.

By using our various build plugins and libraries we have captured some of these patterns to distribute amongst teams. This allows developers to focus on providing value to end users.

## Application Platform Shared Components

### Project Bootstrapper

The project bootstrapper is a utility for generating new projects and/or configuring build pipelines for projects. It works by defining a project in the `projects.json` file and running a script to create and configure a GitHub project, a CircleCI project, a quay.io project and a Kubernetes namespace.

The bootstrapper can be used to copy an existing Kotlin or Typescript template project or can run against an existing project.

As well as removing the effort required to create a build pipeline it allows us to standardise things like GitHub project configuration.

See the project readme on GitHub for usage details.

#### External links (requires login to GitHub)

**GitHub project**: https://github.com/ministryofjustice/dps-project-bootstrap

**projects.json file**: https://github.com/ministryofjustice/dps-project-bootstrap/blob/main/projects.json

### Kotlin Template

The [Kotlin Template project](https://github.com/ministryofjustice/hmpps-template-kotlin) is a skeleton backend Kotlin / Spring Boot application. It can be copied to create a new project.

The application is very light and provides little more than example health checks. The main value is gained from the CircleCI, Helm, Docker, Gradle and Application Insights configurations. These allow a new application to be built and deployed to a Kubernetes namespace. The template application itself runs in the namespace `hmpps-template-kotlin` on Cloud Platform as a test to prove it is deployable.

The template works best in conjunction with the [Project Bootstrapper](#project-bootstrapper) which configures a build pipeline to get the application deployed into Kubernetes.

Any questions or suggestions relating to the Kotlin template should be directed to MOJ Slack channel `#kotlin-dev`.

### Typescript Template

The [Typescript Template project](https://github.com/ministryofjustice/hmpps-template-typescript) is a skeleton frontend / Node application. It can be copied to create a new project.

Note that this template is not a DPS Tech Team project but is community driven and owned by the MOJ Slack channel `#typescript`. It has been included here because it is a great fit with the other offerings.

The application is very light but provides enough detail to get a skeleton application up and running. The template application itself runs in the namespace `hmpps-template-typescript` on Cloud Platform as a test to prove it is deployable.

The template works best in conjunction with the [Project Bootstrapper](#project-bootstrapper) which configures a build pipeline to get the application deployed into Kubernetes.

Any questions or suggestions relating to the Typescript template should be directed to MOJ Slack channel `#typescript`.

### Gradle Build Plugin

The [Gradle Plugin](https://github.com/ministryofjustice/dps-gradle-spring-boot) is used to orchestrate Gradle builds of Java/Kotlin Spring Boot projects. "Orchestrate" means it applies 3rd party Gradle plugins and configures them rather than adding new build logic. The plugins applied can be found in the [build.gradle.kts](https://github.com/ministryofjustice/dps-gradle-spring-boot/blob/main/build.gradle.kts) file.

One notable plugin that is applied to all projects is the [dependency check plugin](https://github.com/dependency-check/dependency-check-gradle). This is run in scheduled CircleCI builds to find vulnerabilities in our dependencies. It also includes a way of suppressing [false positives](https://github.com/ministryofjustice/dps-gradle-spring-boot/blob/main/src/main/resources/dps-gradle-spring-boot-suppressions.xml).

Please see the [project readme](https://github.com/ministryofjustice/dps-gradle-spring-boot) for more information on the plugin.

Note that the plugin is used in our [Kotlin Template project](#kotlin-template).

### CircleCI Orb

The [CircleCI Orb](https://github.com/ministryofjustice/hmpps-circleci-orb) is a plugin used in CircleCI builds to provide standard build executions, jobs and commands.

Jobs exist to perform common tasks such as building and publishing docker images, deploying to environments and running security checks.

Common commands include installing build tools such as AWS CLI and helm and a standard way of generating application versions.

Default executors are available for building different development stacks.

Note that a default CircleCI build using the relevant Orb components is included in both the [Kotlin Template project](#kotlin-template) and the [Typescript Template project](#typescript-template) (in the directory `.circleci`).

More details can be found on the [Orb's registry page](https://circleci.com/developer/orbs/orb/ministryofjustice/hmpps).

### Helm Charts

The [HMPPS Helm Charts project](https://github.com/ministryofjustice/hmpps-helm-charts) provides generic Helm charts that can be used by any service. These are Helm templates with various extension points that can be configured in Helm values files.

A [generic service chart](https://github.com/ministryofjustice/hmpps-helm-charts/tree/main/charts/generic-service) is available to deploy any service into the Kubernetes instance hosted by Cloud Platforms.

A [generic prometheus alerts chart](https://github.com/ministryofjustice/hmpps-helm-charts/tree/main/charts/generic-prometheus-alerts) provides a standard set of alerts for Kubernetes deployments and ingresses.

A [ClamAV chart](https://github.com/ministryofjustice/hmpps-helm-charts/tree/main/charts/clamav) adds an antivirus utility to a namespace.

Note that the generic service chart and generic prometheus alerts chart are used by both the [Kotlin Template project](#kotlin-template) and the [Typescript Template project](#typescript-template) (in the directory `helm_deploy`).

### Spring Boot SQS Starter Library

The [hmpps-spring-boot-sqs project](https://github.com/ministryofjustice/hmpps-spring-boot-sqs) publishes a Spring Boot starter library for using AWS SQS and SNS in a standard HMPPS way.

The library captures various patterns for using the AWS SQS and SNS client libraries that have been widely adopted within HMPPS. These patterns include creating secure clients, JMS listeners, queue health indicators, retry/purge endpoints and integration with the AWS testing utility Localstack.

To see an example of the library in action look at the project's [test application](https://github.com/ministryofjustice/hmpps-spring-boot-sqs/tree/main/test-app) which is used for both functional tests and can be spun up locally. The library has also been used in [several projects](https://github.com/search?q=org%3Aministryofjustice+hmpps-sqs-spring-boot-starter&type=code) and these provide good real life examples.

## Creating A New Service

By using the [application platform shared components](#application-platform-shared-components) it is possible to get a skeleton service into production very quickly.

### Prerequisites

* You must be a member of a team in the [Ministry of Justice](https://github.com/ministryofjustice) GitHub organisation. That team must belong to parent team [HMPPS Developers](https://github.com/orgs/ministryofjustice/teams/hmpps-developers).
* The team must have an MOJ Slack channel. You may want a second channel dedicated to alerts.
* The new service needs a [good name](https://www.gov.uk/service-manual/design/naming-your-service). Note that by convention we use the service name in the DNS domain used by the service. As this will have a size limit try not to make your service name too long - a maximum of 25 characters should be ok.
* Decide which DNS domain to use depending on your user base. `.hmpps.service.justice.gov.uk`, `.prison.service.justice.gov.uk` or `.probation.service.justice.gov.uk` are already available and require no extra work. Anything else will need assistance from Cloud Platform.
* Clone the [cloud-platform-environments git repository](https://github.com/ministryofjustice/cloud-platform-environments).
* Decide upon the type of project - for backend projects we will be using the [Kotlin Template](#kotlin-template-project) and for frontend projects we will be using the [Typescript template](#typescript-template-project).
* Install the Kubernetes CLI [kubectl](https://kubernetes.io/docs/tasks/tools/)

### Creating resources in Cloud Platform

#### Namespaces

Cloud Platforms host a Kubernetes cluster which is logically divided into namespaces aka environments. We deploy applications into these namespaces using Helm. Each application will generally require three namespaces/environments - `dev`, `preprod` and `prod`.

Sometimes it makes sense to group applications together into a single namespace, for example you may have a related UI and API that belong together. This is fine but we would still require multiple environment namespaces for `dev`, `preprod` and `prod`.

Sometimes we need additional environment namespaces, for example some probation applications also have a `staging` namespace to work with the Delius staging environment. This is fine but will mean some extra work in the Circle build and helm configurations when copying the template applications.

#### Do I need a new namespace?

If your application is in a new service area you will definitely need namespaces for the `dev`, `preprod` and `prod` environments. If your application fits nicely alongside existing application(s) you can skip creating a new namespace and reuse the existing ones. However, you will probably need to create a Kubernetes certificate resource for your new application.

#### Creating new namespaces

If you do need new namespaces then you will need to add some terraform to the [cloud-platform-environments git repository](https://github.com/ministryofjustice/cloud-platform-environments).

Each new namespace needs new Kubernetes resources such as an ingress (to allow inbound traffic), access roles (to give humans and build tools access to the namespace), a certificate (to use TLS) amongst others.

##### dev namespace

Initially we will create a dev namespace. We'll refer to this as `<your-new-service-name>-dev` where `<your-new-service-name>` is whatever you've called your new service.

* In the `cloud-platform-environments` repo create a new branch
* Look in directory `namespaces/live-1.cloud-platform.service.justice.gov.uk`
* For APIs take a copy of the `hmpps-template-kotlin` directory or for UIs take a copy of the `hmpps-template-typescript` directory
* For the new directory name append dev to your new service name, e.g. `<your-new-service-name>-dev`

You will now have a bunch of Kubernetes definition files in your new directory. There will be several places that need updating:

* Change the defaults under directory `resources/variables`
* Replace the template namespace references with your new namespace name (e.g. replace all instances of `hmpps-template-kotlin` with `<your-new-service-name>-dev`)
* When finished perform a quick search for the word `template` in your new directory in case you missed any
* Add your GitHub team to the `rbac` yaml - copy the existing subject of kind `Group` but replace `dps-tech` with your GitHub team. (Note you should keep the `dps-tech` Group as this is required for some administration tasks on the namespace).
* Update the certificate's DNS name. By convention we prefer `<your-new-service-name>-dev.hmpps|prison|probation.service.justice.gov.uk` - where you choose one of `hmpps`, `prison` or `probation`
* Check that the certificate's DNS name isn't longer than 63 characters - if it is you'll need to choose a shorter service name

Once your updates are complete push your branch back to the repo and raise a new Pull Request. You'll then need to ask on MOJ Slack channel `#ask_cloud_platform` for a review of the PR. Once approved, merge the PR.

A Concourse job will run in the background which should eventually create your new namespace. When the namespace is ready the command `kubectl get namespaces | grep <your-new-service-name>-dev` should return your new namespace.

##### preprod namespace

To create the preprod namespace we can just take a copy of the recently created dev namespace.

* Update the `cloud-platform-environments` repo and create a new branch
* Look in directory `namespaces/live-1.cloud-platform.service.justice.gov.uk`
* Copy the directory `<your-new-service-name>-dev` but name the new directory `<your-new-service-name>-preprod`

This time you'll need to find all occurrences of `dev` in the directory and rename to `preprod`.

Again you'll need to raise a PR and ask Cloud Platform to review - the same process as for the [dev namespace](#dev-namespace).

##### prod namespace

To create the prod namespace we can just take a copy of the recently created preprod namespace.

* Update the `cloud-platform-environments` repo and create a new branch
* Look in directory `namespaces/live-1.cloud-platform.service.justice.gov.uk`
* Copy the directory `<your-new-service-name>-preprod` but name the new directory `<your-new-service-name>-prod`

This time you'll need to find all occurrences of `preprod` in the directory and rename to `prod`.

However as this is prod there are a few other changes:

* In the namespace yaml, change the `is-production` label to `true`. You may also wish to change the `slack-alert-channel` if you have a different channel for production alerts.
* In the resource/variables yaml, also change the `is-production` variable to `true`.
* In the certificates yaml, take `-prod` out of the DNS name. By convention we only use environment suffixes for non-production host names.
* Add in a pingdom health check. Find another production namespace (e.g. `hmpps-audit-prod`) and copy file `resources/pingdom.tf` into your new directory. Update the name and change the url to match your certificate's `dnsName`.
* Add pingdom version details to the file `resources/versions.tf` (copy an existing production namespace such as `hmpps-audit-prod`).

Once again you'll need to raise a PR and ask Cloud Platform to review - the same process as for the [dev namespace](#dev-namespace).






